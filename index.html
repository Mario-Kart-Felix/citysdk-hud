<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Rectangle Events</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        width: 90%;
        margin: 0px;
        padding: 0px
      }
      #data-button {
        position: absolute;
        top: 0px;
        right: 20px;
      }
      #clear-button {
        position: absolute;
        top: 50px;
        right: 20px;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
var polygon;
function initialize() {
  var mapOptions = {
    center: new google.maps.LatLng(40.45535, -79.97553),
    zoom: 13
  };
  var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  // Construct the polygon, but since it has no path, it will not be displayed.
  polygon = new google.maps.Polygon({
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35
  });

  polygon.setMap(map);

  // Listen to click events on the map and add the point to the polygon's path.
  google.maps.event.addListener(map, 'click', function(event) {
    polygon.getPath().push(event.latLng)
  });
}

/**
 * Queries the City SDK's HUD module using the polygon's path.
 */
function findTheData() {
  var esriJson = {
    'rings' : [[]],
    'spatialReference': {
      'wkid': 4326
    }
  };
  polygon.getPath().forEach(function(latLng, index) {
    esriJson['rings'][0].push([latLng.lng(), latLng.lat()])
  });
  // TODO: Query the City SDK with the esriJson object.
}

/**
 * Resets the polygon's path, removing it from the map.
 */
function clearPolygon() {
  polygon.setPath([]);
}

// Initializes the map when the window loads.
google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <input id="data-button" type="button" value="Find the data" onclick="findTheData()"/>
    <input id="clear-button" type="button" value="Clear polygon" onclick="clearPolygon()"/>
  </body>
</html>
